<!DOCTYPE html>
<html>
<head>
    <title>Test Webhook</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 5px; overflow-x: auto; }
        button { padding: 10px 15px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #45a049; }
        #result { margin-top: 20px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; min-height: 100px; }
    </style>
</head>
<body>
    <h1>Test Webhook</h1>
    <button onclick="testWebhook()">Test Webhook</button>
    <h3>Response:</h3>
    <pre id="result">Click the button to test the webhook</pre>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script>
    async function testWebhook() {
        const resultElement = document.getElementById('result');
        resultElement.textContent = 'Sending request...';
        
        try {
            const requestBody = {
                event: 'payment.captured',
                payload: {
                    payment: {
                        entity: {
                            id: 'pay_test_' + Math.random().toString(36).substring(2, 10),
                            amount: 1000,
                            currency: 'INR',
                            status: 'captured',
                            order_id: 'order_test_' + Math.random().toString(36).substring(2, 10)
                        }
                    }
                }
            };
            
            const requestBodyString = JSON.stringify(requestBody);
            const webhookSecret = 'DTytWzdf2K@9hsk'; // Same as in your .env.local
            
            // Calculate HMAC-SHA256 signature
            const signature = CryptoJS.HmacSHA256(requestBodyString, webhookSecret).toString(CryptoJS.enc.Hex);
            
            const response = await fetch('http://localhost:3000/api/webhook', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-razorpay-signature': signature
                },
                body: requestBodyString
            });
            
            const data = await response.json();
            resultElement.textContent = `Status: ${response.status}\n${JSON.stringify(data, null, 2)}`;
        } catch (error) {
            resultElement.textContent = `Error: ${error.message}\n${error.stack}`;
        }
    }
    </script>
</body>
</html>
